<?xml version="1.0" encoding="UTF-8"?>
<project default="Generate" basedir="." name="Temple-GoogleCode-Examples-Overview" xmlns:ac="antlib:net.sf.antcontrib">
	
	<property name="root.path" value="D:\Projects\Temple\GoogleCode\templelibrary" />
	<property name="tempfolder.path" value="${root.path}/tools/ant/temp" />
	
	<target name="Generate" >
		<antcall target="Clear temp dir" />
		<antcall target="Copy Example files" />
		<antcall target="Parse temp files" />
		<antcall target="Concat temp files" />
		<antcall target="Clear temp dir" />
	</target>
	
	<target name="Clear temp dir" >
		<delete dir="${tempfolder.path}"/>
	</target>
	
	<target name="Copy Example files" >
		<copy todir="${tempfolder.path}">
			<fileset dir="${root.path}/examples" includes="**/*.as">
				<and>
					<containsregexp expression="@exampleText" />
					<containsregexp expression="http\://templelibrary\.googlecode\.com" />
				</and>
			</fileset>
		</copy>
	</target>
	
	<target name="Parse temp files">
		<fileset dir="${tempfolder.path}" includes="**/*.as" id="files" />
	
		<!-- remove everything after 'package' -->
		<replaceregexp match="package(.*)" replace="" flags="gms" >
			<fileset refid="files" />
		</replaceregexp>

		<!-- remove everything before and includiing '@exampleText' -->
		<replaceregexp match="(.*?)@exampleText" replace="&lt;div class='example' &gt;" flags="gms" >
			<fileset refid="files" />
		</replaceregexp>

		<!-- remove comment stars -->
		<replaceregexp match=" \* " replace="" flags="gms" >
			<fileset refid="files" />
		</replaceregexp>

		<!-- remove comment close tag -->
		<replaceregexp match=" \*/" replace="&lt;hr/&gt;&lt;/div&gt;" flags="gms" >
			<fileset refid="files" />
		</replaceregexp>
		
	</target>
	
	<target name="Concat temp files">
		<concat destfile="${root.path}/examples/index.html" >
			<header file="${root.path}/tools/ant/templates/header.html" />
			<fileset dir="${tempfolder.path}" includes="**/*.as" />
			<footer file="${root.path}/tools/ant/templates/footer.html" />
		</concat>
		
	</target>
	
</project>